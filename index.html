<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Poker Hand History to XML</title>
</head>
<body>
    <h1>Poker Hand History zu XML Konverter</h1>
    <textarea id="historyInput" rows="10" cols="50" placeholder="Füge hier deine Poker-Hand-Historie ein..."></textarea><br>
    <button onclick="convertToXML()">Konvertieren</button>
    <pre id="output"></pre>

    <script>
        function convertToXML() {
            const inputText = document.getElementById('historyInput').value;

            // Beispiel-Daten aus der Pokerhand-Historie extrahieren
            const handData = extractHandData(inputText);

            if (!handData || Object.keys(handData).length === 0) {
                console.error("Ungültige Hand-Daten extrahiert");
                return;
            }

            // Generiere XML
            const xml = generateXML(handData);
            document.getElementById('output').textContent = xml;
        }

        function extractHandData(handHistory) {
            if (!handHistory || typeof handHistory !== 'string') {
                console.error("Ungültige Hand-Historie Eingabe");
                return {};
            }

            console.log("Hand-Historie Eingabe: ", handHistory);

            const lines = handHistory.split('\n');
            let handData = {};
            let currentSection = null;

            lines.forEach(line => {
                const trimmedLine = line.trim();

                // Parsing different sections
                if (trimmedLine.startsWith("Hand #")) {
                    handData.handNumber = trimmedLine.split(" - ")[0].trim();
                    handData.date = trimmedLine.split(" - ")[1].trim();
                } else if (trimmedLine.startsWith("Game:")) {
                    handData.gameType = trimmedLine.split(":")[1].trim();
                } else if (trimmedLine.startsWith("Site:")) {
                    handData.site = trimmedLine.split(":")[1].trim();
                } else if (trimmedLine.startsWith("Table:")) {
                    handData.tableName = trimmedLine.split(":")[1].trim();
                } else if (trimmedLine.startsWith("Seat")) {
                    const seatData = trimmedLine.split(":");
                    const seatNumber = seatData[0].trim();
                    const playerData = seatData[1].trim();

                    // Ensure players array exists
                    handData.players = handData.players || [];
                    handData.players.push({ seat: seatNumber, player: playerData, chips: "" }); // Default empty chips for now
                } else if (trimmedLine.startsWith("** Flop **") || trimmedLine.startsWith("** Turn **") || trimmedLine.startsWith("** River **")) {
                    handData.board = trimmedLine.replace("**", "").replace("**", "").trim();
                } else if (trimmedLine.startsWith("** Summary **")) {
                    currentSection = "summary";
                } else if (currentSection === "summary") {
                    
                }
            });

            console.log("Parsed Hand Data: ", handData);
            return handData;
        }

        function generateXML(data) {
            let xml = `<?xml version="1.0" encoding="utf-8" ?>\n<hand number="${data.handNumber}" date="${data.date}">\n`;

            // Game Information
            xml += `<game>${data.gameType || "Unbekannt"}</game>\n`;
            xml += `<site>${data.site || "Unbekannt"}</site>\n`;
            xml += `<table>${data.tableName || "Unbekannt"}</table>\n`;

            // Players
            xml += `<players>\n`;
            if (data.players && Array.isArray(data.players)) {
                data.players.forEach(player => {
                    // Only push the player details if the data exists
                    xml += `<player seat="${player.seat}" chips="${player.chips || "0"}">${player.player}</player>\n`;
                });
            }
            xml += `</players>\n`;

            // Actions
            xml += `<actions>\n`;
            if (data.actions && Array.isArray(data.actions)) {
                data.actions.forEach(action => {
                    xml += `<action>${action}</action>\n`;
                });
            }
            xml += `</actions>\n`;

            xml += `</hand>`;

            return xml;
        }
    </script>
</body>
</html>
